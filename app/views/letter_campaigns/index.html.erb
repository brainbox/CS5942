<h1>Graph For Campaigns </h1>
  
<%= form_tag letter_campaigns_path,  :method => 'get' do %>
<div id="form-dates">
	Start Date: <input class="picker" name="first" type="text" /></br>
	End Date: <input class="picker" name="last" type="text" /></br>
	Interval: <input type="text" name="interval" value="<%= @interval %>"/>
</div>

<div id="form-campaign">
	<%-(0..4).each do |num| %>
		<select name="campaign<%= num %>">
			<option value="0">-- none --</option>
			<%- @campaigns.each do |campaign| %>
				<option value="<%= campaign %>"><%= campaign %></option>
			<%- end %>
		</select>
	<%- end %>
</div>

<%= submit_tag "Load Graph", :name => nil %>
<% end %>





<% if @first -%>
<script type="text/javascript" charset="utf-8">
  $(function() {
    new Highcharts.Chart({
      chart: {
        renderTo: "campaign_chart",
	
	zoomType: 'x',
        spacingRight: 20
      },
      title: {
        text: "Letters per day"
      },
      xAxis: {  
        type: "datetime",
	 maxZoom: 14 * 24 * 3600000, // fourteen days
        labels: {
	  rotation: -45,
          align: 'right',
          formatter: function() {
           return Highcharts.dateFormat("%b %e, %Y", this.value-1);
          }
        }
	
      },
      yAxis: {
        title: {
          text: "Number of Letters"
        }
      },
   
      tooltip: {
	  
        formatter: function() {
          return Highcharts.dateFormat("%B %e, %Y", this.x) + ': ' + 
                 Highcharts.numberFormat(this.y, 0) + ' letters' + '<br/> Campaigns: ' + this.series.name ;
        }
	
      },
      
     series: [
      <%- @series.each_key do |key| %>
      {
          name: '<%= key %>',
          pointInterval: <%= @interval.days * 1000 %>,
          pointStart: <%= (@first + 1.day).to_i * 1000 %>,
          pointEnd: <%= (@last + 1.day).to_i * 1000  %>,
          data: <%= @series[key] %>
         },
       <%- end %>
       ],
    });
  });
</script>
<div id="campaign_chart" style="width:1200px; height: 600px;"></div>
<% end -%>
<br />
<br />





<br />




<%= link_to 'New Letter campaign', new_letter_campaign_path %>
